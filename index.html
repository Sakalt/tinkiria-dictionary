<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>チシア辞書</title>
    <style>
        button {
            background-color: #00aa00;
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            cursor: pointer;
        }
        button:hover {
            background-color: #009900;
        }
        .dictionary-entry {
            border-bottom: 1px solid #ddd;
            padding: 10px 0;
        }
    </style>
</head>
<body>
    <h1>チシア辞書</h1>
    <div>
        <button id="prevButton">前へ</button>
        <button id="nextButton">次へ</button>
    </div>
    <div>
        <label for="search">検索:</label>
        <input type="text" id="search" onkeyup="searchDictionary()">
    </div>
    <div id="dictionary"></div>
    <div>
        <p id="currentPageInfo"></p>
        <p id="wordCountInfo"></p>
        <p id="characterRatioInfo"></p>
    </div>
    <script>
        let dictionaryData = [];
        let filteredData = [];
        let currentPage = 1;
        const itemsPerPage = 10;
        const dictionaryDiv = document.getElementById("dictionary");

        async function fetchDictionaryData() {
            try {
                const response = await fetch('dictionary.json');
                dictionaryData = await response.json();
                filteredData = dictionaryData;
                displayDictionary();
            } catch (error) {
                console.error('辞書データの取得エラー:', error);
            }
        }

        function displayDictionary() {
            dictionaryDiv.innerHTML = "";
            const startIndex = (currentPage - 1) * itemsPerPage;
            const endIndex = Math.min(startIndex + itemsPerPage, filteredData.length);

            for (let i = startIndex; i < endIndex; i++) {
                const entry = document.createElement("div");
                entry.classList.add("dictionary-entry");
                entry.innerHTML = `
                    <p>日本語: ${filteredData[i].japanese}</p>
                    <p>チシア語: ${filteredData[i].tisian}</p>
                    <p>説明: ${filteredData[i].definition}</p>
                    <p>例文: ${filteredData[i].examples.join(", ")}</p>
                    <p>種類: ${filteredData[i].type}</p>
                `;
                dictionaryDiv.appendChild(entry);
            }

            document.getElementById("currentPageInfo").textContent = `ページ ${currentPage}`;
            document.getElementById("wordCountInfo").textContent = `現在の単語数: ${filteredData.length}`;
            displayCharacterRatio();
        }

        function displayCharacterRatio() {
            const charCount = {};
            const totalChars = filteredData.reduce((total, entry) => {
                entry.tisian.split('').forEach(char => {
                    charCount[char] = (charCount[char] || 0) + 1;
                });
                return total + entry.tisian.length;
            }, 0);

            const ratioInfo = Object.keys(charCount).map(char => {
                const percentage = ((charCount[char] / totalChars) * 100).toFixed(2);
                return `${char}: ${percentage}%`;
            }).join(", ");
            document.getElementById("characterRatioInfo").textContent = `文字の割合: ${ratioInfo}`;
        }

        function showPage(page) {
            currentPage = page;
            displayDictionary();
        }

        function nextPage() {
            if (currentPage * itemsPerPage < filteredData.length) {
                currentPage++;
                showPage(currentPage);
            }
        }

        function prevPage() {
            if (currentPage > 1) {
                currentPage--;
                showPage(currentPage);
            }
        }

        function searchDictionary() {
            const searchQuery = document.getElementById("search").value.toLowerCase();
            filteredData = dictionaryData.filter(entry => 
                entry.japanese.toLowerCase().includes(searchQuery) || 
                entry.tisian.toLowerCase().includes(searchQuery)
            );
            currentPage = 1;
            displayDictionary();
        }

        document.getElementById("nextButton").addEventListener("click", nextPage);
        document.getElementById("prevButton").addEventListener("click", prevPage);

        fetchDictionaryData();
    </script>
</body>
</html>
